{
    "docs": [
        {
            "location": "/", 
            "text": "Welcome to Blendugsatr project\n\n\nSemana 1\n\n\nEn esta primera semana los elementos a implementar son los siguientes:\n\n\n\n\nUn ISP\n\n\nCon redundancia \n\n\nEncaminamiento din\u00e1mico\n\n\n\n\n\n\nLa sede principal de una empresa\n\n\nTres subredes distintas (Data Center, Servicios Online e intranet)\n\n\nAsignaci\u00f3n de par\u00e1metros de red autom\u00e1tico\n\n\nConfiguraci\u00f3n de NAT\n\n\n\n\n\n\nUna sede secundaria conectada a otro router frontera\n\n\nAsignaci\u00f3n de par\u00e1metros de red autom\u00e1tico\n\n\nConfiguraci\u00f3n de NAT\n\n\n\n\n\n\n\n\nSemana 2\n\n\nEn esta segunda semana la cosa se complica. Adem\u00e1s de lo ya implementado anteriormente hay que implementar:\n\n\n\n\nRedundancia y protecci\u00f3n ante ca\u00eddas en la sede principal\n\n\nConexi\u00f3n con un ISP de backup\n\n\nDos VPNs entre las sedes\n\n\nUna Trusted VPN a trav\u00e9s del ISP principal\n\n\nUna VPN corporativa a trav\u00e9s del ISP secundario\n\n\n\n\n\n\n\n\nSemana 3\n\n\nEn esta tercera y ultima semana es necesario implementar ademas de todo lo anterior:\n\n\n\n\nImplementar IPv6 mediante 6rd en el ISP 2\n\n\nAcceso mediante xDSL\n\n\n\n\nEnunciados\n\n\nSemana 1\n\n\nLa empresa Blendugsargh se dedica a la venta de BlendugsThings. El negocio va bien y son ya 4 sedes las que tiene diseminadas en su pa\u00eds de origen, Blendugsland. Para su conectividad han elegido una topolog\u00eda \u00abhub and spoke,\u00bb y han contratado el servicio de red al operador BlendungsComm (que tambi\u00e9n operar\u00e1 como ISP).\n\n\nEn la sede principal, se establecen tres subredes diferentes para dar cobijo a su Data Center, servicios online e intranet corporativa, respectivamente. La empresa contrata con el RIPE el uso del prefijo de red 203.0.112.0/23 (que utilizar\u00e1 en la vlan en la que ofrece sus servicios al exterior), as\u00ed como el identificador de sistema aut\u00f3nomo 64501 y utiliza direccionamiento privado para sus otras subredes. En las dem\u00e1s sucursales, solo implementan un subconjunto de la intranet corporativa.\n\n\nImplementad un escenario que comprenda la sede principal, una sucursal y el operador de red contratado. La maqueta debe incluir al menos dos equipos finales por cada subred. Adem\u00e1s, la red del operador debe presentar redundancia con encaminamiento din\u00e1mico, y la asignaci\u00f3n de los par\u00e1metros de red en las redes internas debe ser autom\u00e1tico.\n\n\nVarias aclaraciones:\na) Recomendamos usar gns3 para hacer la simulaci\u00f3n, utilizando\ndiversos modelos de routers haciendo labores de equipos finales y/o switches.\nc) Pod\u00e9is emplear cualquier tipo de enlace para unir los dispositivos\nd) La simulaci\u00f3n puede ampliarse con interfaces de red nativas para conectar con otros simuladores y/o m\u00e1quinas virtuales o incluso procesos en vuestro propio equipo. \u00a1No hay l\u00edmite!\n\n\nSemana 2\n\n\nEl modelo de negocio de nuestra empresa se basa principalmente en la venta online, y los recursos\nque se han dispuesto para ello (servidores, bases de datos, ...) residen exclusivamente en la sede principal.\nEn consecuencia, la disponiblidad en este punto es cr\u00edtica.\n\n\nPara evitar quedarnos sin conectividad por alg\u00fan fallo en la infraestructura de comunicaciones, en la sede\nprincipal se duplican los equipos de red (switches/routers) proveyendo redundancia que soporte al menos\nla ca\u00edda de uno de dichos dispositivos.\n\n\nEn la misma l\u00ednea, se contrata con dos proveedores de servicio de red la conexi\u00f3n a Internet, de tal forma\nque uno de ellos actuar\u00e1 de backup en caso de que el ISP principal (ISP1) deje de dar servicio. Al ISP primario \u2013que\nimplementa MPLS en su infraestructura\u2013 tambi\u00e9n se le contrata un servicio de VPN corporativo (Trusted VPN), que\nposibilite la visibilidad de las subredes internas del Hub (intranet y data center) en cada una de las sucursales.\n\n\nComo tambi\u00e9n es importante no dejar sin conectividad con la sede principal a los trabajadores de las sucursales\n(en caso de fallo del ISP1), los ingenieros telem\u00e1ticos de la empresa implementan per se (ahorro de costes)\nel servicio de VPN corporativo usando el acceso a Internet alternativo contratado con el ISP2.\n\n\n\n\n\n\nTareas m\u00ednimas a realizar:\n\n\n\n\nRedundancia de salida en la sede\n\n\nVPN MPLS\n\n\nT\u00faneles a trav\u00e9s del ISP 2 entre todas las sedes\n\n\n\n\n\n\n\n\nTareas opcionales:\n\n\n\n\nSalida a Internet de las sucursales s\u00f3lo a trav\u00e9s de la sede\n\n\nUso de GRE multipunto para los t\u00faneles a trav\u00e9s del ISP2 (sin IPSEC)\n\n\nUso de GRE multipunto para los t\u00faneles a trav\u00e9s del ISP2 (con IPSEC)\n\n\nAcceso a Internet a trav\u00e9s de la VPN MPLS (adicional a la del ISP2)\n\n\n\n\n\n\n\n\nPalabras clave:\n\n\nVRRP/HSRP, MPLS, vrf, mgre/nhrp, ipsec, BGP\n\n\nInformaci\u00f3n sobre GRE multipunto:\nhttp://www.cisco.com/c/en/us/support/docs/security-vpn/ipsec-negotiation-ike-protocols/41940-dmvpn.html\n\n\nSemana 3\n\n\nDespliegue IPv6\n\n\n\n\n\n\nEl ISP2, que utilizamos como backup para la sede principal y para alguna/s de la/s sucursales, consciente de la competencia de otros operadores, decide ofrecer a sus clientes la posibilidad de disfrutar de conectividad IPv6. El servicio, que comercializan bajo el lema \u00abInjOy-iT, IoT is in da house\u00bb, es ofrecido sin aumento de tarifa para los usuarios/empresas que ya son clientes, y con un coste m\u00ednimo adicional para los advenedizos. Tal generosidad obedece realmente a que dicho operador tendr\u00e1 que hacer m\u00ednimos cambios en la infraestructura de su red de transporte (que seguir\u00e1 siendo una red IPv4) al elegir como soluci\u00f3n tecnol\u00f3gica \u00ab6rd\u00bb (IPv6 Rapid Deployment).\n\n\n\n\n\n\nImplementa el despliegue de esta tecnolog\u00eda/servicio para que las sucursales de nuestra empresa tengan doble conectividad (IPv4/IPv6) en su red interna. (Los clientes 6rd \u2013CPEs\u2013 recibir\u00e1n un prefijo /56 que subdividir\u00e1n internamente seg\u00fan sus necesidades; y los terminales deber\u00e1n obtener su direcci\u00f3n IPv6 de forma din\u00e1mica). Considere que para ofrecer el servicio IPv6, el ISP2 obtiene el rango 2001:aaaa::/38 y usa el subrango 2001:aaaa::/40 para el servicio 6rd propiamente dicho. Para probar el servicio, dote de IPv6 tambi\u00e9n a un tercer ISP para probar la conectivad.\n\n\n\n\n(OPCIONAL) \u00cddem para la sede principal, donde se definir\u00e1n tantos rangos/subredes IPv6 como redes internas tenga definidas. (Palabras clave: L2TPv3, pseudowire, local switching)\n\n\n\n\n\n\n\n\nAcceso xDSL\n\n\n\n\n\n\nMaritta Blendugsb\u00fcrger, trabajadora de la sede principal de Blendugsargh, tiene contratado un acceso xDSL en su domicilio con un ISP que no posee infraestructura propia de comunicaciones cerca de su vecindario. Pero el OBLA, que s\u00ed llega hasta su hogar, le aporta el acceso indirecto que necesita a trav\u00e9s de un enlace Ethernet entre CPE y NAS, y una red de transporte IP entre el NAS y el correspondiente BBRAS del ISP.\n\n\n\n\n\n\nImplementa dicho servicio de acceso indirecto y prueba su funcionamiento accediendo al servicio de ventas online de nuestra empresa.\n\n\n\n\n\n\nPara las autenticaciones de los clientes (CPE) utilizaremos duplas \u00abusuario,password\u00bb, donde el usuario tendr\u00e1 la estructura username@ISPdomain (por ejemplo: 7749@isp99.com); utilizando la segunda parte del nombre de usuario para localizar en el LAC (NAS) la IP del LNS (BBRAS), y la primera para propiamente autenticar al cliente ante el ISP.\n\n\n\n\n\n\n(OPCIONAL) Para facilitar el teletrabajo, nuestra empresa implementa un *servicio VPN de acceso remoto en la sede principal.\n\n\nImplementa la soluci\u00f3n \u00abvpdn\u00bb en el servidor/concentrador de vpns del hub, y pru\u00e9bala usando cualquier cliente ppp ya preinstalado en el terminal que utilizar\u00e1 Maritta para conectarse remotamente a su intranet.\n\n\n\n\n\n\n(OPCIONAL) Utiliza un servidor AAA (freeradius) para realizar de forma centralizada las tareas de autenticaci\u00f3n (acreditaci\u00f3n de los clientes/usuarios) y autorizaci\u00f3n (p.e., localizaci\u00f3n de la IP del router de acceso del ISP) inherentes al protocolo PPP y al servicio vpdn.\n\n\nAcerca del servidor freeradius: Configurad el servidor freeradius en una m\u00e1quina Linux (en un ordenador real que est\u00e9 conectado a Internet, en una m\u00e1quina virtual que conect\u00e9is en alg\u00fan enclave de la red de nuestro ISP, o en el propio equipo donde ejecut\u00e1is la simulaci\u00f3n).\n\n\n\n\n\n\n\n\n\n\nAcr\u00f3nimos:\n\n\nIoT Internet of Things\nOBLA Operador del Bucle Local de Abonados\nNAS Network Access Server (v\u00e9ase como el BRAS del operador de acceso en una soluci\u00f3n PPPoEoE con BRAS dual)\nBBRAS BroadBand Remote Access Server\nLAC L2TP Access Concentrator\nLNS L2TP Network Server\nAAA Authentication, Authorization, Accounting\nvpdn virtual private data network\nCPE Customer Premise Equipment", 
            "title": "Home"
        }, 
        {
            "location": "/#welcome-to-blendugsatr-project", 
            "text": "", 
            "title": "Welcome to Blendugsatr project"
        }, 
        {
            "location": "/#semana-1", 
            "text": "En esta primera semana los elementos a implementar son los siguientes:   Un ISP  Con redundancia   Encaminamiento din\u00e1mico    La sede principal de una empresa  Tres subredes distintas (Data Center, Servicios Online e intranet)  Asignaci\u00f3n de par\u00e1metros de red autom\u00e1tico  Configuraci\u00f3n de NAT    Una sede secundaria conectada a otro router frontera  Asignaci\u00f3n de par\u00e1metros de red autom\u00e1tico  Configuraci\u00f3n de NAT", 
            "title": "Semana 1"
        }, 
        {
            "location": "/#semana-2", 
            "text": "En esta segunda semana la cosa se complica. Adem\u00e1s de lo ya implementado anteriormente hay que implementar:   Redundancia y protecci\u00f3n ante ca\u00eddas en la sede principal  Conexi\u00f3n con un ISP de backup  Dos VPNs entre las sedes  Una Trusted VPN a trav\u00e9s del ISP principal  Una VPN corporativa a trav\u00e9s del ISP secundario", 
            "title": "Semana 2"
        }, 
        {
            "location": "/#semana-3", 
            "text": "En esta tercera y ultima semana es necesario implementar ademas de todo lo anterior:   Implementar IPv6 mediante 6rd en el ISP 2  Acceso mediante xDSL", 
            "title": "Semana 3"
        }, 
        {
            "location": "/#enunciados", 
            "text": "", 
            "title": "Enunciados"
        }, 
        {
            "location": "/#semana-1_1", 
            "text": "La empresa Blendugsargh se dedica a la venta de BlendugsThings. El negocio va bien y son ya 4 sedes las que tiene diseminadas en su pa\u00eds de origen, Blendugsland. Para su conectividad han elegido una topolog\u00eda \u00abhub and spoke,\u00bb y han contratado el servicio de red al operador BlendungsComm (que tambi\u00e9n operar\u00e1 como ISP).  En la sede principal, se establecen tres subredes diferentes para dar cobijo a su Data Center, servicios online e intranet corporativa, respectivamente. La empresa contrata con el RIPE el uso del prefijo de red 203.0.112.0/23 (que utilizar\u00e1 en la vlan en la que ofrece sus servicios al exterior), as\u00ed como el identificador de sistema aut\u00f3nomo 64501 y utiliza direccionamiento privado para sus otras subredes. En las dem\u00e1s sucursales, solo implementan un subconjunto de la intranet corporativa.  Implementad un escenario que comprenda la sede principal, una sucursal y el operador de red contratado. La maqueta debe incluir al menos dos equipos finales por cada subred. Adem\u00e1s, la red del operador debe presentar redundancia con encaminamiento din\u00e1mico, y la asignaci\u00f3n de los par\u00e1metros de red en las redes internas debe ser autom\u00e1tico.  Varias aclaraciones:\na) Recomendamos usar gns3 para hacer la simulaci\u00f3n, utilizando\ndiversos modelos de routers haciendo labores de equipos finales y/o switches.\nc) Pod\u00e9is emplear cualquier tipo de enlace para unir los dispositivos\nd) La simulaci\u00f3n puede ampliarse con interfaces de red nativas para conectar con otros simuladores y/o m\u00e1quinas virtuales o incluso procesos en vuestro propio equipo. \u00a1No hay l\u00edmite!", 
            "title": "Semana 1"
        }, 
        {
            "location": "/#semana-2_1", 
            "text": "El modelo de negocio de nuestra empresa se basa principalmente en la venta online, y los recursos\nque se han dispuesto para ello (servidores, bases de datos, ...) residen exclusivamente en la sede principal.\nEn consecuencia, la disponiblidad en este punto es cr\u00edtica.  Para evitar quedarnos sin conectividad por alg\u00fan fallo en la infraestructura de comunicaciones, en la sede\nprincipal se duplican los equipos de red (switches/routers) proveyendo redundancia que soporte al menos\nla ca\u00edda de uno de dichos dispositivos.  En la misma l\u00ednea, se contrata con dos proveedores de servicio de red la conexi\u00f3n a Internet, de tal forma\nque uno de ellos actuar\u00e1 de backup en caso de que el ISP principal (ISP1) deje de dar servicio. Al ISP primario \u2013que\nimplementa MPLS en su infraestructura\u2013 tambi\u00e9n se le contrata un servicio de VPN corporativo (Trusted VPN), que\nposibilite la visibilidad de las subredes internas del Hub (intranet y data center) en cada una de las sucursales.  Como tambi\u00e9n es importante no dejar sin conectividad con la sede principal a los trabajadores de las sucursales\n(en caso de fallo del ISP1), los ingenieros telem\u00e1ticos de la empresa implementan per se (ahorro de costes)\nel servicio de VPN corporativo usando el acceso a Internet alternativo contratado con el ISP2.    Tareas m\u00ednimas a realizar:   Redundancia de salida en la sede  VPN MPLS  T\u00faneles a trav\u00e9s del ISP 2 entre todas las sedes     Tareas opcionales:   Salida a Internet de las sucursales s\u00f3lo a trav\u00e9s de la sede  Uso de GRE multipunto para los t\u00faneles a trav\u00e9s del ISP2 (sin IPSEC)  Uso de GRE multipunto para los t\u00faneles a trav\u00e9s del ISP2 (con IPSEC)  Acceso a Internet a trav\u00e9s de la VPN MPLS (adicional a la del ISP2)", 
            "title": "Semana 2"
        }, 
        {
            "location": "/#palabras-clave", 
            "text": "VRRP/HSRP, MPLS, vrf, mgre/nhrp, ipsec, BGP  Informaci\u00f3n sobre GRE multipunto:\nhttp://www.cisco.com/c/en/us/support/docs/security-vpn/ipsec-negotiation-ike-protocols/41940-dmvpn.html", 
            "title": "Palabras clave:"
        }, 
        {
            "location": "/#semana-3_1", 
            "text": "", 
            "title": "Semana 3"
        }, 
        {
            "location": "/#despliegue-ipv6", 
            "text": "El ISP2, que utilizamos como backup para la sede principal y para alguna/s de la/s sucursales, consciente de la competencia de otros operadores, decide ofrecer a sus clientes la posibilidad de disfrutar de conectividad IPv6. El servicio, que comercializan bajo el lema \u00abInjOy-iT, IoT is in da house\u00bb, es ofrecido sin aumento de tarifa para los usuarios/empresas que ya son clientes, y con un coste m\u00ednimo adicional para los advenedizos. Tal generosidad obedece realmente a que dicho operador tendr\u00e1 que hacer m\u00ednimos cambios en la infraestructura de su red de transporte (que seguir\u00e1 siendo una red IPv4) al elegir como soluci\u00f3n tecnol\u00f3gica \u00ab6rd\u00bb (IPv6 Rapid Deployment).    Implementa el despliegue de esta tecnolog\u00eda/servicio para que las sucursales de nuestra empresa tengan doble conectividad (IPv4/IPv6) en su red interna. (Los clientes 6rd \u2013CPEs\u2013 recibir\u00e1n un prefijo /56 que subdividir\u00e1n internamente seg\u00fan sus necesidades; y los terminales deber\u00e1n obtener su direcci\u00f3n IPv6 de forma din\u00e1mica). Considere que para ofrecer el servicio IPv6, el ISP2 obtiene el rango 2001:aaaa::/38 y usa el subrango 2001:aaaa::/40 para el servicio 6rd propiamente dicho. Para probar el servicio, dote de IPv6 tambi\u00e9n a un tercer ISP para probar la conectivad.   (OPCIONAL) \u00cddem para la sede principal, donde se definir\u00e1n tantos rangos/subredes IPv6 como redes internas tenga definidas. (Palabras clave: L2TPv3, pseudowire, local switching)", 
            "title": "Despliegue IPv6"
        }, 
        {
            "location": "/#acceso-xdsl", 
            "text": "Maritta Blendugsb\u00fcrger, trabajadora de la sede principal de Blendugsargh, tiene contratado un acceso xDSL en su domicilio con un ISP que no posee infraestructura propia de comunicaciones cerca de su vecindario. Pero el OBLA, que s\u00ed llega hasta su hogar, le aporta el acceso indirecto que necesita a trav\u00e9s de un enlace Ethernet entre CPE y NAS, y una red de transporte IP entre el NAS y el correspondiente BBRAS del ISP.    Implementa dicho servicio de acceso indirecto y prueba su funcionamiento accediendo al servicio de ventas online de nuestra empresa.    Para las autenticaciones de los clientes (CPE) utilizaremos duplas \u00abusuario,password\u00bb, donde el usuario tendr\u00e1 la estructura username@ISPdomain (por ejemplo: 7749@isp99.com); utilizando la segunda parte del nombre de usuario para localizar en el LAC (NAS) la IP del LNS (BBRAS), y la primera para propiamente autenticar al cliente ante el ISP.    (OPCIONAL) Para facilitar el teletrabajo, nuestra empresa implementa un *servicio VPN de acceso remoto en la sede principal.  Implementa la soluci\u00f3n \u00abvpdn\u00bb en el servidor/concentrador de vpns del hub, y pru\u00e9bala usando cualquier cliente ppp ya preinstalado en el terminal que utilizar\u00e1 Maritta para conectarse remotamente a su intranet.    (OPCIONAL) Utiliza un servidor AAA (freeradius) para realizar de forma centralizada las tareas de autenticaci\u00f3n (acreditaci\u00f3n de los clientes/usuarios) y autorizaci\u00f3n (p.e., localizaci\u00f3n de la IP del router de acceso del ISP) inherentes al protocolo PPP y al servicio vpdn.  Acerca del servidor freeradius: Configurad el servidor freeradius en una m\u00e1quina Linux (en un ordenador real que est\u00e9 conectado a Internet, en una m\u00e1quina virtual que conect\u00e9is en alg\u00fan enclave de la red de nuestro ISP, o en el propio equipo donde ejecut\u00e1is la simulaci\u00f3n).", 
            "title": "Acceso xDSL"
        }, 
        {
            "location": "/#acronimos", 
            "text": "IoT Internet of Things\nOBLA Operador del Bucle Local de Abonados\nNAS Network Access Server (v\u00e9ase como el BRAS del operador de acceso en una soluci\u00f3n PPPoEoE con BRAS dual)\nBBRAS BroadBand Remote Access Server\nLAC L2TP Access Concentrator\nLNS L2TP Network Server\nAAA Authentication, Authorization, Accounting\nvpdn virtual private data network\nCPE Customer Premise Equipment", 
            "title": "Acr\u00f3nimos:"
        }, 
        {
            "location": "/Anotaciones/", 
            "text": "Cosas a tener en cuenta/aclaraciones\n\n\n\n\nAl hacer un ping a una direcci\u00f3n interna del core desde un equipo exterior devuelve un \nICMP type:3, code:13, Communication administratively prohibited)\n. Tras comprobarlo con el Wireshark se ve que el paquete NO entra en el core y por tanto es correcto.", 
            "title": "Anotaciones"
        }, 
        {
            "location": "/Anotaciones/#cosas-a-tener-en-cuentaaclaraciones", 
            "text": "Al hacer un ping a una direcci\u00f3n interna del core desde un equipo exterior devuelve un  ICMP type:3, code:13, Communication administratively prohibited) . Tras comprobarlo con el Wireshark se ve que el paquete NO entra en el core y por tanto es correcto.", 
            "title": "Cosas a tener en cuenta/aclaraciones"
        }, 
        {
            "location": "/Comandos/", 
            "text": "Visualizar rutas\n\n\nshow ip route          # Muestra todas la tabla de encaminamiento\nshow ip route ospf     # Muestra las rutas aprendidas por OSPF\nshow ip route A.B.C.D  # Muestra la informaci\u00f3n sobre la ruta a ese host   \n\n\n\n\nDebugear BGP\n\n\ndebug bgp all                           #Activar el debug de BGP\nshow ip route {IP del vecino}           #Comprobar que hay conexi\u00f3n con el vecino\nshow ip bgp neighbors [IP del vecino]   #Datos sobre vecino/s\n\n\n\n\nTrusted VPN\n\n\nshow ip route vrf \nNombre de la VRF\n    #Muestra las entradas de la VRF", 
            "title": "Comandos"
        }, 
        {
            "location": "/Comandos/#visualizar-rutas", 
            "text": "show ip route          # Muestra todas la tabla de encaminamiento\nshow ip route ospf     # Muestra las rutas aprendidas por OSPF\nshow ip route A.B.C.D  # Muestra la informaci\u00f3n sobre la ruta a ese host", 
            "title": "Visualizar rutas"
        }, 
        {
            "location": "/Comandos/#debugear-bgp", 
            "text": "debug bgp all                           #Activar el debug de BGP\nshow ip route {IP del vecino}           #Comprobar que hay conexi\u00f3n con el vecino\nshow ip bgp neighbors [IP del vecino]   #Datos sobre vecino/s", 
            "title": "Debugear BGP"
        }, 
        {
            "location": "/Comandos/#trusted-vpn", 
            "text": "show ip route vrf  Nombre de la VRF     #Muestra las entradas de la VRF", 
            "title": "Trusted VPN"
        }, 
        {
            "location": "/Nombres_Routers/", 
            "text": "ISP1\n\n\n\n\n\n\n\n\nTopologia\n\n\nFichero\n\n\n\n\n\n\n\n\n\n\nFronteraIzquierda\n\n\ni1_startup-config.cfg\n\n\n\n\n\n\nFronteraArriba\n\n\ni2_startup-config.cfg\n\n\n\n\n\n\nFronteraDerecha\n\n\ni3_startup-config.cfg\n\n\n\n\n\n\nFronteraAbajo\n\n\ni4_startup-config.cfg\n\n\n\n\n\n\nFronteraDerechaISP2\n\n\ni5_startup-config.cfg\n\n\n\n\n\n\nCore1\n\n\ni6_startup-config.cfg\n\n\n\n\n\n\nCore2\n\n\ni7_startup-config.cfg\n\n\n\n\n\n\nCore3\n\n\ni8_startup-config.cfg\n\n\n\n\n\n\nCore4\n\n\ni9_startup-config.cfg\n\n\n\n\n\n\nCore5\n\n\ni10_startup-config.cfg\n\n\n\n\n\n\nCore6\n\n\ni11_startup-config.cfg\n\n\n\n\n\n\n\n\nSedes\n\n\n\n\n\n\n\n\nTopologia\n\n\nFichero\n\n\n\n\n\n\n\n\n\n\nR_SedePrincipal\n\n\ni12_startup-config.cfg\n\n\n\n\n\n\nR_SedePrincipalISP2\n\n\ni22_startup-config.cfg\n\n\n\n\n\n\nNAT_SedePrincipal\n\n\ni23_startup-config.cfg\n\n\n\n\n\n\nSedeAbajo (Cisco 7200)\n\n\ni25_startup-config.cfg\n\n\n\n\n\n\nSedeDerecha (Cisco 7200)\n\n\ni26_startup-config.cfg\n\n\n\n\n\n\n\n\nISP2\n\n\n\n\n\n\n\n\nTopologia\n\n\nFichero\n\n\n\n\n\n\n\n\n\n\nFronteraArribaISP2\n\n\ni13_startup-config.cfg\n\n\n\n\n\n\nFronteraAbajoISP2\n\n\ni16_startup-config.cfg\n\n\n\n\n\n\nFronteraIzquierdaISP2\n\n\ni17_startup-config.cfg\n\n\n\n\n\n\n\n\nISP3\n\n\n\n\n\n\n\n\nTopologia\n\n\nFichero\n\n\n\n\n\n\n\n\n\n\nF_Arriba_Internet\n\n\ni18_startup-config.cfg\n\n\n\n\n\n\nF_Abajo_Internet\n\n\ni19_startup-config.cfg\n\n\n\n\n\n\nF_Izquierda_Internet\n\n\ni20_startup-config.cfg\n\n\n\n\n\n\nF_Derecha_Internet\n\n\ni21_startup-config.cfg", 
            "title": "Nombres Routers"
        }, 
        {
            "location": "/Nombres_Routers/#isp1", 
            "text": "Topologia  Fichero      FronteraIzquierda  i1_startup-config.cfg    FronteraArriba  i2_startup-config.cfg    FronteraDerecha  i3_startup-config.cfg    FronteraAbajo  i4_startup-config.cfg    FronteraDerechaISP2  i5_startup-config.cfg    Core1  i6_startup-config.cfg    Core2  i7_startup-config.cfg    Core3  i8_startup-config.cfg    Core4  i9_startup-config.cfg    Core5  i10_startup-config.cfg    Core6  i11_startup-config.cfg", 
            "title": "ISP1"
        }, 
        {
            "location": "/Nombres_Routers/#sedes", 
            "text": "Topologia  Fichero      R_SedePrincipal  i12_startup-config.cfg    R_SedePrincipalISP2  i22_startup-config.cfg    NAT_SedePrincipal  i23_startup-config.cfg    SedeAbajo (Cisco 7200)  i25_startup-config.cfg    SedeDerecha (Cisco 7200)  i26_startup-config.cfg", 
            "title": "Sedes"
        }, 
        {
            "location": "/Nombres_Routers/#isp2", 
            "text": "Topologia  Fichero      FronteraArribaISP2  i13_startup-config.cfg    FronteraAbajoISP2  i16_startup-config.cfg    FronteraIzquierdaISP2  i17_startup-config.cfg", 
            "title": "ISP2"
        }, 
        {
            "location": "/Nombres_Routers/#isp3", 
            "text": "Topologia  Fichero      F_Arriba_Internet  i18_startup-config.cfg    F_Abajo_Internet  i19_startup-config.cfg    F_Izquierda_Internet  i20_startup-config.cfg    F_Derecha_Internet  i21_startup-config.cfg", 
            "title": "ISP3"
        }, 
        {
            "location": "/Notas/", 
            "text": "1) HSRP con tracking\n\n\nRefinar NAT: Aplicar solo cuando la IP destino sea publica\n\n\nPara solucionar lo de las VRFs: Dos VLANs distintas, con dos subinterfaces. Una para la VRF y otra para exportar las rutas\nExportar a la tabla principal todas las subredes p\u00fablicas\n\n\nNext hop self en los routers frontera con bgp", 
            "title": "Notas"
        }, 
        {
            "location": "/Protocolos/", 
            "text": "OSPF\n\n\nEst\u00e1 implementado en todo el core del ISP, otorgando conectividad entre todos los routers interiores. Es muy sencillo de configurar, los comandos a usar son los siguientes:\n\n\n# Desde (config)#\nrouter ospf ID\nnetwork 0.0.0.0 255.255.255.255 area 0\n\n\n\n\n\nBGP\n\n\nMultiples usos que requieren una configuraci\u00f3n variada. La configuraci\u00f3n b\u00e1sica es:\n\n\n# Desde (config)#\nrouter bgp {ID del AS}\nnetwork A.B.C.D mask E.F.G.H\nneighbor {IP del vecino} remote-as {ID del AS al que nos conectamos}\n\n# Si usamos la loopback (recomendado) hace falta indicarlo\nneighbor {IP del vecino} update-source loopback {N\u00ba de la loopback}\n\n\n\n\n\n\n\nAqu\u00ed a\u00f1adiremos el resto de usos de BGP\n\n\n\n\nDHCP\n\n\nUsado para asignar de forma est\u00e1tica las IPs (tanto privadas dentro de una subred como p\u00fablicas a lso routers de los clientes). La configuraci\u00f3n es la que sigue:\n\n\n# Desde (config)#\nip dhcp pool nombre_del_pool\nnetwork A.B.C.D/XX\ndefault-router A.B.C.E\nend\n\n#Si queremos que alguna direcci\u00f3n no se asigne:\nip dhcp excluded-address A.B.C.D\n\n\n\n\nNAT din\u00e1mico con sobrecarga\n\n\nPermite utilizar una \u00fanica direcci\u00f3n publica cuando los equipos de una subred quieren conectarse a Internet. Los comandos son los siguientes:\n\n\n# Creamos una lista de acceso\naccess-list {100-199} permit ip A.B.C.D {WildCard de la m\u00e1scara} any\n\n# Creamos NAT asign\u00e1ndole la lista de acceso\nip nat inside source list {100-199} interface {Interfaz de salida} overload\n\n# Asignamos a cada interfaz su rol (nat inside o nat outside)\nip nat {inside | outside}", 
            "title": "Protocolos"
        }, 
        {
            "location": "/Protocolos/#ospf", 
            "text": "Est\u00e1 implementado en todo el core del ISP, otorgando conectividad entre todos los routers interiores. Es muy sencillo de configurar, los comandos a usar son los siguientes:  # Desde (config)#\nrouter ospf ID\nnetwork 0.0.0.0 255.255.255.255 area 0", 
            "title": "OSPF"
        }, 
        {
            "location": "/Protocolos/#bgp", 
            "text": "Multiples usos que requieren una configuraci\u00f3n variada. La configuraci\u00f3n b\u00e1sica es:  # Desde (config)#\nrouter bgp {ID del AS}\nnetwork A.B.C.D mask E.F.G.H\nneighbor {IP del vecino} remote-as {ID del AS al que nos conectamos}\n\n# Si usamos la loopback (recomendado) hace falta indicarlo\nneighbor {IP del vecino} update-source loopback {N\u00ba de la loopback}   Aqu\u00ed a\u00f1adiremos el resto de usos de BGP", 
            "title": "BGP"
        }, 
        {
            "location": "/Protocolos/#dhcp", 
            "text": "Usado para asignar de forma est\u00e1tica las IPs (tanto privadas dentro de una subred como p\u00fablicas a lso routers de los clientes). La configuraci\u00f3n es la que sigue:  # Desde (config)#\nip dhcp pool nombre_del_pool\nnetwork A.B.C.D/XX\ndefault-router A.B.C.E\nend\n\n#Si queremos que alguna direcci\u00f3n no se asigne:\nip dhcp excluded-address A.B.C.D", 
            "title": "DHCP"
        }, 
        {
            "location": "/Protocolos/#nat-dinamico-con-sobrecarga", 
            "text": "Permite utilizar una \u00fanica direcci\u00f3n publica cuando los equipos de una subred quieren conectarse a Internet. Los comandos son los siguientes:  # Creamos una lista de acceso\naccess-list {100-199} permit ip A.B.C.D {WildCard de la m\u00e1scara} any\n\n# Creamos NAT asign\u00e1ndole la lista de acceso\nip nat inside source list {100-199} interface {Interfaz de salida} overload\n\n# Asignamos a cada interfaz su rol (nat inside o nat outside)\nip nat {inside | outside}", 
            "title": "NAT din\u00e1mico con sobrecarga"
        }, 
        {
            "location": "/Pruebas/", 
            "text": "Semana 1\n\n\n\n\nPing entre dos routers frontera\n\n\nPing entre un equipo final y una direcci\u00f3n p\u00fablica\n\n\nPing desde un equipo final al servicio online de la sede principal\n\n\nQue no se pueda hacer ping entre un router del core y uno de fuera\n\n\n\n\nSemana 2\n\n\nTrusted VPN\n\n\n\n\nPing entre un host de la sede principal y un host de la secundaria (comprobando que no se haga NAT).\n\n\nPing entre un host y un equipo de \"Internet\" (comprobando que S\u00cd se hace NAT).\n\n\nPing entre un host de una sede secundaria a los servicios p\u00fablicos de la principal (comprobar que va por fuera de la VPN)\n\n\nPing entre un equipo fuera de la VPN y los servicios p\u00fablicos. \n\n\n\n\nConjuntas de ambas VPN\n\n\n\n\nApagar el router principal de la sede principal. Comprobar en el Firewall que la gateway para las rutas de la VPN es ahora el router de backup.\n\n\nComprobar que si se apaga un router necesario para la Trusted VPN en una de las sedes se pasa a usar sin problemas la VPN secundaria (s\u00f3lo con la sede afectada, el resto siguen por la principal).\n\n\n\n\nSalida/entrada doble a Internet\n\n\n\n\nComprobar que al hacer un ping desde un router de Internet a una direcci\u00f3n perteneciente a los servicios p\u00fablicos de la sede principal el paquete entra por:\n\n\nSi s\u00f3lo uno de los routers est\u00e1n encendidos, el tr\u00e1fico entrar\u00e1 por ah\u00ed.\n\n\nSi est\u00e1n ambos encendidos entrar\u00e1 por el principal, ya que tiene un AS-PATH inferior al compartirlo por BGP", 
            "title": "Pruebas"
        }, 
        {
            "location": "/Pruebas/#semana-1", 
            "text": "Ping entre dos routers frontera  Ping entre un equipo final y una direcci\u00f3n p\u00fablica  Ping desde un equipo final al servicio online de la sede principal  Que no se pueda hacer ping entre un router del core y uno de fuera", 
            "title": "Semana 1"
        }, 
        {
            "location": "/Pruebas/#semana-2", 
            "text": "Trusted VPN   Ping entre un host de la sede principal y un host de la secundaria (comprobando que no se haga NAT).  Ping entre un host y un equipo de \"Internet\" (comprobando que S\u00cd se hace NAT).  Ping entre un host de una sede secundaria a los servicios p\u00fablicos de la principal (comprobar que va por fuera de la VPN)  Ping entre un equipo fuera de la VPN y los servicios p\u00fablicos.    Conjuntas de ambas VPN   Apagar el router principal de la sede principal. Comprobar en el Firewall que la gateway para las rutas de la VPN es ahora el router de backup.  Comprobar que si se apaga un router necesario para la Trusted VPN en una de las sedes se pasa a usar sin problemas la VPN secundaria (s\u00f3lo con la sede afectada, el resto siguen por la principal).   Salida/entrada doble a Internet   Comprobar que al hacer un ping desde un router de Internet a una direcci\u00f3n perteneciente a los servicios p\u00fablicos de la sede principal el paquete entra por:  Si s\u00f3lo uno de los routers est\u00e1n encendidos, el tr\u00e1fico entrar\u00e1 por ah\u00ed.  Si est\u00e1n ambos encendidos entrar\u00e1 por el principal, ya que tiene un AS-PATH inferior al compartirlo por BGP", 
            "title": "Semana 2"
        }, 
        {
            "location": "/Reparto de IPs/", 
            "text": "En el ISP\n\n\n\n\n\n\n\n\nNombre\n\n\nPrefijo de red\n\n\nM\u00e1scara de subred\n\n\nAnotaciones\n\n\n\n\n\n\n\n\n\n\nInteriores\n\n\n192.168.1.X\n\n\n255.255.255.252\n\n\nDonde X toma valores de cuatro en cuatro (0, 4, 8, ...)\n\n\n\n\n\n\nLoopbacks\n\n\n192.168.11.X\n\n\n255.255.255.255\n\n\n\n\n\n\n\n\nPool p\u00fablico\n\n\n20.0.0.0\n\n\n255.255.254.0\n\n\nEn cada enlace con un cliente del servicio Trusted VPN se usaran dos subredes, una para tr\u00e1fico normal y otro para la VRF\n\n\n\n\n\n\n\n\nEn el ISP secundario\n\n\n\n\n\n\n\n\nNombre\n\n\nPrefijo de red\n\n\nM\u00e1scara de subred\n\n\nAnotaciones\n\n\n\n\n\n\n\n\n\n\nInteriores\n\n\n192.168.2.X\n\n\n255.255.255.252\n\n\nDonde X toma valores de cuatro en cuatro (0, 4, 8, ...)\n\n\n\n\n\n\nLoopbacks\n\n\n192.168.22.X\n\n\n255.255.255.255\n\n\n\n\n\n\n\n\nLoopback 6rd\n\n\n30.0.255.2\n\n\n255.255.255.255\n\n\nNecesaria para el funcionamiento del 6rd\n\n\n\n\n\n\nLoopback xDSL\n\n\n21.0.0.2\n\n\n255.255.255.255\n\n\nNecesaria xDSL\n\n\n\n\n\n\nPool p\u00fablico\n\n\n30.0.0.0\n\n\n255.255.254.0\n\n\n\n\n\n\n\n\n\n\nEn la sucursal principal\n\n\n\n\n\n\n\n\nNombre\n\n\nPrefijo de red\n\n\nM\u00e1scara de subred\n\n\nAnotaciones\n\n\n\n\n\n\n\n\n\n\nPool p\u00fablico\n\n\n203.0.112.0\n\n\n255.255.255.0\n\n\nAsignadas a equipos que proporcionan Servicios Online\n\n\n\n\n\n\nDirecciones administrativas\n\n\n203.0.113.0\n\n\n255.255.255.248\n\n\nHemos dividido nuestro prefijo p\u00fablico en dos, uno para los equipos y otro para usos administrativos\n\n\n\n\n\n\nIntranet\n\n\n10.0.4.0\n\n\n255.255.255.0\n\n\n\n\n\n\n\n\nData Center\n\n\n10.0.2.0\n\n\n255.255.255.0\n\n\n\n\n\n\n\n\n\n\nEn la sucursal secundaria (derecha)\n\n\n\n\n\n\n\n\nNombre\n\n\nPrefijo de red\n\n\nM\u00e1scara de subred\n\n\nAnotaciones\n\n\n\n\n\n\n\n\n\n\nIntranet\n\n\n10.0.0.0\n\n\n255.255.255.0\n\n\n\n\n\n\n\n\n\n\nEn la sucursal secundaria (abajo)\n\n\n\n\n\n\n\n\nNombre\n\n\nPrefijo de red\n\n\nM\u00e1scara de subred\n\n\nAnotaciones\n\n\n\n\n\n\n\n\n\n\nIntranet\n\n\n10.0.3.0\n\n\n255.255.255.0", 
            "title": "Reparto de IPs"
        }, 
        {
            "location": "/Reparto de IPs/#en-el-isp", 
            "text": "Nombre  Prefijo de red  M\u00e1scara de subred  Anotaciones      Interiores  192.168.1.X  255.255.255.252  Donde X toma valores de cuatro en cuatro (0, 4, 8, ...)    Loopbacks  192.168.11.X  255.255.255.255     Pool p\u00fablico  20.0.0.0  255.255.254.0  En cada enlace con un cliente del servicio Trusted VPN se usaran dos subredes, una para tr\u00e1fico normal y otro para la VRF", 
            "title": "En el ISP"
        }, 
        {
            "location": "/Reparto de IPs/#en-el-isp-secundario", 
            "text": "Nombre  Prefijo de red  M\u00e1scara de subred  Anotaciones      Interiores  192.168.2.X  255.255.255.252  Donde X toma valores de cuatro en cuatro (0, 4, 8, ...)    Loopbacks  192.168.22.X  255.255.255.255     Loopback 6rd  30.0.255.2  255.255.255.255  Necesaria para el funcionamiento del 6rd    Loopback xDSL  21.0.0.2  255.255.255.255  Necesaria xDSL    Pool p\u00fablico  30.0.0.0  255.255.254.0", 
            "title": "En el ISP secundario"
        }, 
        {
            "location": "/Reparto de IPs/#en-la-sucursal-principal", 
            "text": "Nombre  Prefijo de red  M\u00e1scara de subred  Anotaciones      Pool p\u00fablico  203.0.112.0  255.255.255.0  Asignadas a equipos que proporcionan Servicios Online    Direcciones administrativas  203.0.113.0  255.255.255.248  Hemos dividido nuestro prefijo p\u00fablico en dos, uno para los equipos y otro para usos administrativos    Intranet  10.0.4.0  255.255.255.0     Data Center  10.0.2.0  255.255.255.0", 
            "title": "En la sucursal principal"
        }, 
        {
            "location": "/Reparto de IPs/#en-la-sucursal-secundaria-derecha", 
            "text": "Nombre  Prefijo de red  M\u00e1scara de subred  Anotaciones      Intranet  10.0.0.0  255.255.255.0", 
            "title": "En la sucursal secundaria (derecha)"
        }, 
        {
            "location": "/Reparto de IPs/#en-la-sucursal-secundaria-abajo", 
            "text": "Nombre  Prefijo de red  M\u00e1scara de subred  Anotaciones      Intranet  10.0.3.0  255.255.255.0", 
            "title": "En la sucursal secundaria (abajo)"
        }, 
        {
            "location": "/Servicios_implementados/", 
            "text": "Trusted VPN\n\n\nHemos implementado una trusted VPN entre las distintas sedes de la empresa. Los pasos a seguir son los siguientes:\n\n\n1) Creamos dos subinterfaces en el enlace entre frontera y cliente.\n\n\ninterface XX.Y\nip address {IP que queramos usar para tr\u00e1fico normal} {M\u00e1scara}\n\ninterface XX.Z\nip address {IP de la conexi\u00f3n BGP para la VRF} {M\u00e1scara}\n\n\n\n\n2) Configuramos MPLS en las interfaces de los routers del ISP:\n\n\ninterface XX\nmpls ip\n\n#Comandos de comprobaci\u00f3n\nshow mpls interfaces\nshow mpls ldp neighbor\n\n\n\n\n3) Creamos las VRFs en los routers frontera:\n\n\n#Repetimos estos comandos en todos los routers frontera que participen en la VPN.\nip vrf {Nombre de la VRF}\nrd XXXXX:XX\nroute-target both XXXXX:XX\n\n\n\n\n4) Asignamos las VRFs a las interfaces del router:\n\n\ninterface XX.Z\nip vrf forwarding {Nombre de la VRF}\n\n#Debemos asignar de nuevo la ip a la interfaz\nip add {IP} {M\u00e1scara}\n\n\n\n\n5) Configuramos BGP entre los routers frontera.\n\n\nrouter bgp {identificador del AS}\n\nneighbor {IP de la loopback del vecino} remote-as {identificador del AS}\nneighbor {IP de la loopback del vecino} update-source loopback 0\n\naddress-family vpnv4\nneighbor {IP de la loopback del vecino} activate\n\n#Repetimos en el otro vecino\n\n\n\n\n6) Configuramos BGP entre los routers frontera y el router del cliente.\n\n\n#En el router frontera\nrouter bgp {identificador del AS}\n\naddress-family ipv4 vrf Blendugs\nneighbor {IP de la subinterfaz VRF del vecino} remote-as {ID del AS del vecino}\nneighbor {IP de la subinterfaz VRF del vecino} activate\n\n#En el router del cliente\nrouter bgp {Identificador del AS}\n\n#Se repite tantas veces como redes se quieran compartir\nnetwork {Prefijo de la VPN} mask {M\u00e1scara del prefjo}\n\nneighbor {IP de la subinterfaz VRF del router frontera} remote-as {ID del AS del ISP}\n\n\n\n\nOpcional: Filtrado de las rutas que compartes con cada vecino\n\n\n\n#En el router del cliente\n\n#Rutas que NO queremos enviar, una l\u00ednea por cada\naccess-list {1-99} deny {Prefijo que no queremos enviar} {Wildcard de la m\u00e1scara}\naccess-list {1-99} deny {Prefijo que no queremos enviar} {Wildcard de la m\u00e1scara}\naccess-list {1-99} permit any\n\nrouter bgp {ID del AS}\n\n#En caso de no haberlo hecho ya a\u00f1adir todas las rutas que queramos transmitir\nnetwork {Prefijo a transmitir} mask {M\u00e1scara del prefijo}\n\n#Le asignamos una lista de distribuci\u00f3n que filtre las direcciones que se le env\u00edan a ese vecino\nneighbor {IP del vecino} distribute-list {1-99} out\n\n\n\n\nVPN GRE Multipunto con IPSEC\n\n\nSpoke Router\n\n\n\nSedeDerecha(config)#crypto isakmp policy 1\nSedeDerecha(config-isakmp)#authentication pre-share\nSedeDerecha(config-isakmp)#exit\nSedeDerecha(config)#crypto isakmp key cisco47 address 0.0.0.0 0.0.0.0\nSedeDerecha(config)#crypto ipsec transform-set trans2 esp-des esp-md5-hmac\nSedeDerecha(cfg-crypto-trans)#mode transport\nSedeDerecha(cfg-crypto-trans)#exit\nSedeDerecha(config)#crypto ipsec profile vpnprof\nSedeDerecha(ipsec-profile)#set transform-set trans2\nSedeDerecha(ipsec-profile)#exit\n\nSedeDerecha(config)#interface tunnel 0\nSedeDerecha(config-if)#bandwidth 1000\nSedeDerecha(config-if)#ip address 192.168.0.3 255.255.255.0\nSedeDerecha(config-if)#ip mtu 1400\nSedeDerecha(config-if)#ip nhrp authentication test\nSedeDerecha(config-if)#ip nhrp map multicast 30.0.0.2\nSedeDerecha(config-if)#ip nhrp map 192.168.0.1 30.0.0.2\nSedeDerecha(config-if)#ip nhrp network-id 100000\nSedeDerecha(config-if)#ip nhrp holdtime 300\nSedeDerecha(config-if)#ip nhrp nhs 192.168.0.1\nSedeDerecha(config-if)#ip ospf network broadcast\nSedeDerecha(config-if)#ip ospf priority 0\nSedeDerecha(config-if)#delay 1000\nSedeDerecha(config-if)#tunnel source fastEthernet 1/0\nSedeDerecha(config-if)#tunnel mode gre multipoint\nSedeDerecha(config-if)#tunnel key 100000\nSedeDerecha(config-if)#tunnel protection ipsec profile vpnprof\nSedeDerecha(config-if)#exit\n\nSedeDerecha(config)#router ospf 1\nSedeDerecha(config-router)#network 10.0.0.0 0.0.0.255 area 0\nSedeDerecha(config-router)#network 192.168.0.0 0.0.0.255 area 0\nSedeDerecha(config-router)#exit\n\n\n\n\n\nFalta a\u00f1adir la del HUB Router\n\n\nFuente: http://www.cisco.com/c/en/us/support/docs/security-vpn/ipsec-negotiation-ike-protocols/41940-dmvpn.html\n\n\nElecci\u00f3n del router de entrada a la sede principal\n\n\nDado que tenemos dos routers desde los que se puede entrar a la sede debemos tener alg\u00fan mecanismo para indicar por cu\u00e1l queremos que entre el trafico. \nEl m\u00e9todo que vamos a usar es modificar el AS-PATH que comparte el router frontera de backup, para que as\u00ed tenga un coste superior a las rutas compartidas desde el otro. Estas rutas tendr\u00e1n un coste superior\nporque el primer par\u00e1metro que examina BGP para calcular el coste es el AS-PATH, no el n\u00famero de saltos.\n\n\n\n\n\n\nCreamos un route-map en el router de backup\n\n\nroute-map {Nombre} permit {N\u00famero, por ejemplo 10}\n\n\n\n\n\n\n\nDentro del route-map le indicamos que concatene varias veces nuestro n\u00famero de AS en el AS-PATH\n\n\nset as-path prepend 64501 64501 64501\n\n\n\n\n\n\n\nA continuaci\u00f3n entramos en BGP, y le indicamos que use con el vecino que queramos el route-map que acabamos de crear.\n\n\nrouter bgp {ID del AS}\n    neighboor {IP del vecino} route-map {Nombre del route-map}\n\n\n\n\n\n\n\nIncorporaci\u00f3n de un Firewall en la sede principal\n\n\nEl objetivo de este equipo es completar nuestros servicios orientados a \nla protecci\u00f3n antifallos de la sede principal. Nos va a pemitir mantener\nla conectividad con el exterior incluso cuando se caiga la conexi\u00f3n con \nuno de los ISPs (ya sea porque se caiga el PE del ISP o nuestro CPE). Para conseguirlo hemos seguido estos pasos:\n\n\n\n\n\n\nCreamos una red /29 entre el firewall y ambos CPE, usando direcciones de nuestro\npool p\u00fablico\n\n\n\n\n\n\nConfiguramos una conexi\u00f3n BGP entre cada CPE y el firewall\n\n\nrouter bgp 64501\n    neighbor 203.0.113.9 remote-as 64501\n    neighbor 203.0.113.9 next-hop-self\n\n\n\n\n\n\n\nEn el caso del CPE principal redistribuimos las rutas a direcciones\nprivadas, ya que son las pertenecientes a la trusted VPN.\n\n\naccess-list 11 permit 192.168.0.0 0.0.255.255\naccess-list 11 permit 10.0.0.0 0.255.255.255\naccess-list 11 permit 172.16.0.0 0.15.255.255\naccess-list 11 permit 169.254.0.0 0.0.255.255\naccess-list 11 deny   any\n\nrouter bgp 64501\n    neighbor 203.0.113.9 distribute-list 11 out\n\n\n\n\n\n\n\nEn el caso del CPE secundario tambi\u00e9n redistribuimos algo \nPeite completa aqu\u00ed\n\n\nrouter bgp 64501\n     bgp redistribute-internal\n\n\n\n\n\n\n\nPor \u00faltimo configuramos HSRP en ambos CPEs para protegernos ante ca\u00eddas de uno de ellos\n\n\n\n\n\n\nCon esas configuraciones conseguimos que el tr\u00e1fico saliente a una direcci\u00f3n p\u00fablica vaya por el router adecuado (HSRP) y que el tr\u00e1fico de la VPN vaya por la principal\n siempre que sea posible\n\n\n6RD\n\n\nPara implementar IPv6 de forma sencilla sin migrar el core de IPv4 a IPv6 utilizamos 6RD. Se basa en encapsular trafico IPv6 en paquetes IPv4.\nUtiliza tuneles multipunto para conectar los routers de los clientes a un router frontera conectado a una red IPv6.\nNota: Solo es necesario IOS 15 para implementar esta funcionalidad\n\n\nBorder Router\n\n\n\n\n\n\nActivamos IPv6 en el router\n\n\n ipv6 unicast-routing\n ipv6 cef\n\n\n\n\n\n\n\nCreamos una Loopback con una ip publica. (Necesaria, ya que si no los paquetes irian con ips privadas) y guardamos prefijo que usa 6rd\n\n\n ipv6 general-prefix DELEGATED_PREFIX 6rd Tunnel0\n interface Loopback1\n  ip address 30.0.255.2 255.255.255.255\n\n\n\n\n\n\n\nCreamos el tunel\n\n\n  interface Tunnel1\n   no ip address\n   no ip redirects\n   ipv6 address DELEGATED_PREFIX ::/128 anycast\n   tunnel source Loopback1\n   tunnel mode ipv6ip 6rd\n   tunnel 6rd ipv4 prefix-len 16\n   tunnel 6rd prefix 2001:AAAA::/40\n\n\n\n\n\n\n\nEnrutamos el trafico IPv6 que llega al router por el tunel que acabamos de crear\n\n\n ipv6 route 2001:AAAA::/40 Tunnel1\n\n\n\n\n\n\n\nCE Router\n\n\n\n\n\n\nActivamos IPv6 en el router\n\n\n ipv6 unicast-routing\n ipv6 cef\n\n\n\n\n\n\n\nGuardamos prefijo que usa 6rd\n\n\n ipv6 general-prefix DELEGATED_PREFIX 6rd Tunnel0\n\n\n\n\n\n\n\nCreamos el tunel\n\n\n  interface Tunnel1\n   no ip address\n   no ip redirects\n   ipv6 enable\n   tunnel source FastEthernet1/0\n   tunnel mode ipv6ip 6rd\n   tunnel 6rd ipv4 prefix-len 16\n   tunnel 6rd prefix 2001:AAAA::/40\n   tunnel 6rd br 30.0.255.2\n\n\n\n\n\n\n\nLe damos una IPv6 a la interfaz interna del router\n\n\n  ipv6 address DELEGATED_PREFIX ::/64 eui-64\n\n\n\n\n\n\n\nEnrutamos el trafico IPv6 que llega al router por el tunel que acabamos de crear\n\n\n ipv6 route 2001:AAAA::/40 Tunnel1\n ipv6 route ::/0 Tunnel1 2001:AAAA:FF:200::\n\n\n\n\n\n\n\nAutoconfiguracion equipos\n\n\nUna vez hecho todo esto, los equipos restantes se configuran solos automaticamente. Cogiendo el prefijo adecuadamente.\n\n\nEnlaces\n\n\n\n\nhttp://www.cisco.com/c/en/us/products/collateral/ios-nx-os-software/enterprise-ipv6-solution/whitepaper_c11-665758.html\n\n\nhttp://www.cisco.com/c/en/us/td/docs/ios-xml/ios/interface/configuration/xe-3s/ir-xe-3s-book/ip6-6rd-tunls-xe.pdf\n\n\nhttps://meetings.apnic.net/__data/assets/pdf_file/0017/31148/APRICOT-6rd-final.pdf", 
            "title": "Servicios implementados"
        }, 
        {
            "location": "/Servicios_implementados/#trusted-vpn", 
            "text": "Hemos implementado una trusted VPN entre las distintas sedes de la empresa. Los pasos a seguir son los siguientes:  1) Creamos dos subinterfaces en el enlace entre frontera y cliente.  interface XX.Y\nip address {IP que queramos usar para tr\u00e1fico normal} {M\u00e1scara}\n\ninterface XX.Z\nip address {IP de la conexi\u00f3n BGP para la VRF} {M\u00e1scara}  2) Configuramos MPLS en las interfaces de los routers del ISP:  interface XX\nmpls ip\n\n#Comandos de comprobaci\u00f3n\nshow mpls interfaces\nshow mpls ldp neighbor  3) Creamos las VRFs en los routers frontera:  #Repetimos estos comandos en todos los routers frontera que participen en la VPN.\nip vrf {Nombre de la VRF}\nrd XXXXX:XX\nroute-target both XXXXX:XX  4) Asignamos las VRFs a las interfaces del router:  interface XX.Z\nip vrf forwarding {Nombre de la VRF}\n\n#Debemos asignar de nuevo la ip a la interfaz\nip add {IP} {M\u00e1scara}  5) Configuramos BGP entre los routers frontera.  router bgp {identificador del AS}\n\nneighbor {IP de la loopback del vecino} remote-as {identificador del AS}\nneighbor {IP de la loopback del vecino} update-source loopback 0\n\naddress-family vpnv4\nneighbor {IP de la loopback del vecino} activate\n\n#Repetimos en el otro vecino  6) Configuramos BGP entre los routers frontera y el router del cliente.  #En el router frontera\nrouter bgp {identificador del AS}\n\naddress-family ipv4 vrf Blendugs\nneighbor {IP de la subinterfaz VRF del vecino} remote-as {ID del AS del vecino}\nneighbor {IP de la subinterfaz VRF del vecino} activate\n\n#En el router del cliente\nrouter bgp {Identificador del AS}\n\n#Se repite tantas veces como redes se quieran compartir\nnetwork {Prefijo de la VPN} mask {M\u00e1scara del prefjo}\n\nneighbor {IP de la subinterfaz VRF del router frontera} remote-as {ID del AS del ISP}  Opcional: Filtrado de las rutas que compartes con cada vecino  \n#En el router del cliente\n\n#Rutas que NO queremos enviar, una l\u00ednea por cada\naccess-list {1-99} deny {Prefijo que no queremos enviar} {Wildcard de la m\u00e1scara}\naccess-list {1-99} deny {Prefijo que no queremos enviar} {Wildcard de la m\u00e1scara}\naccess-list {1-99} permit any\n\nrouter bgp {ID del AS}\n\n#En caso de no haberlo hecho ya a\u00f1adir todas las rutas que queramos transmitir\nnetwork {Prefijo a transmitir} mask {M\u00e1scara del prefijo}\n\n#Le asignamos una lista de distribuci\u00f3n que filtre las direcciones que se le env\u00edan a ese vecino\nneighbor {IP del vecino} distribute-list {1-99} out", 
            "title": "Trusted VPN"
        }, 
        {
            "location": "/Servicios_implementados/#vpn-gre-multipunto-con-ipsec", 
            "text": "Spoke Router  \nSedeDerecha(config)#crypto isakmp policy 1\nSedeDerecha(config-isakmp)#authentication pre-share\nSedeDerecha(config-isakmp)#exit\nSedeDerecha(config)#crypto isakmp key cisco47 address 0.0.0.0 0.0.0.0\nSedeDerecha(config)#crypto ipsec transform-set trans2 esp-des esp-md5-hmac\nSedeDerecha(cfg-crypto-trans)#mode transport\nSedeDerecha(cfg-crypto-trans)#exit\nSedeDerecha(config)#crypto ipsec profile vpnprof\nSedeDerecha(ipsec-profile)#set transform-set trans2\nSedeDerecha(ipsec-profile)#exit\n\nSedeDerecha(config)#interface tunnel 0\nSedeDerecha(config-if)#bandwidth 1000\nSedeDerecha(config-if)#ip address 192.168.0.3 255.255.255.0\nSedeDerecha(config-if)#ip mtu 1400\nSedeDerecha(config-if)#ip nhrp authentication test\nSedeDerecha(config-if)#ip nhrp map multicast 30.0.0.2\nSedeDerecha(config-if)#ip nhrp map 192.168.0.1 30.0.0.2\nSedeDerecha(config-if)#ip nhrp network-id 100000\nSedeDerecha(config-if)#ip nhrp holdtime 300\nSedeDerecha(config-if)#ip nhrp nhs 192.168.0.1\nSedeDerecha(config-if)#ip ospf network broadcast\nSedeDerecha(config-if)#ip ospf priority 0\nSedeDerecha(config-if)#delay 1000\nSedeDerecha(config-if)#tunnel source fastEthernet 1/0\nSedeDerecha(config-if)#tunnel mode gre multipoint\nSedeDerecha(config-if)#tunnel key 100000\nSedeDerecha(config-if)#tunnel protection ipsec profile vpnprof\nSedeDerecha(config-if)#exit\n\nSedeDerecha(config)#router ospf 1\nSedeDerecha(config-router)#network 10.0.0.0 0.0.0.255 area 0\nSedeDerecha(config-router)#network 192.168.0.0 0.0.0.255 area 0\nSedeDerecha(config-router)#exit  Falta a\u00f1adir la del HUB Router  Fuente: http://www.cisco.com/c/en/us/support/docs/security-vpn/ipsec-negotiation-ike-protocols/41940-dmvpn.html", 
            "title": "VPN GRE Multipunto con IPSEC"
        }, 
        {
            "location": "/Servicios_implementados/#eleccion-del-router-de-entrada-a-la-sede-principal", 
            "text": "Dado que tenemos dos routers desde los que se puede entrar a la sede debemos tener alg\u00fan mecanismo para indicar por cu\u00e1l queremos que entre el trafico. \nEl m\u00e9todo que vamos a usar es modificar el AS-PATH que comparte el router frontera de backup, para que as\u00ed tenga un coste superior a las rutas compartidas desde el otro. Estas rutas tendr\u00e1n un coste superior\nporque el primer par\u00e1metro que examina BGP para calcular el coste es el AS-PATH, no el n\u00famero de saltos.    Creamos un route-map en el router de backup  route-map {Nombre} permit {N\u00famero, por ejemplo 10}    Dentro del route-map le indicamos que concatene varias veces nuestro n\u00famero de AS en el AS-PATH  set as-path prepend 64501 64501 64501    A continuaci\u00f3n entramos en BGP, y le indicamos que use con el vecino que queramos el route-map que acabamos de crear.  router bgp {ID del AS}\n    neighboor {IP del vecino} route-map {Nombre del route-map}", 
            "title": "Elecci\u00f3n del router de entrada a la sede principal"
        }, 
        {
            "location": "/Servicios_implementados/#incorporacion-de-un-firewall-en-la-sede-principal", 
            "text": "El objetivo de este equipo es completar nuestros servicios orientados a \nla protecci\u00f3n antifallos de la sede principal. Nos va a pemitir mantener\nla conectividad con el exterior incluso cuando se caiga la conexi\u00f3n con \nuno de los ISPs (ya sea porque se caiga el PE del ISP o nuestro CPE). Para conseguirlo hemos seguido estos pasos:    Creamos una red /29 entre el firewall y ambos CPE, usando direcciones de nuestro\npool p\u00fablico    Configuramos una conexi\u00f3n BGP entre cada CPE y el firewall  router bgp 64501\n    neighbor 203.0.113.9 remote-as 64501\n    neighbor 203.0.113.9 next-hop-self    En el caso del CPE principal redistribuimos las rutas a direcciones\nprivadas, ya que son las pertenecientes a la trusted VPN.  access-list 11 permit 192.168.0.0 0.0.255.255\naccess-list 11 permit 10.0.0.0 0.255.255.255\naccess-list 11 permit 172.16.0.0 0.15.255.255\naccess-list 11 permit 169.254.0.0 0.0.255.255\naccess-list 11 deny   any\n\nrouter bgp 64501\n    neighbor 203.0.113.9 distribute-list 11 out    En el caso del CPE secundario tambi\u00e9n redistribuimos algo  Peite completa aqu\u00ed  router bgp 64501\n     bgp redistribute-internal    Por \u00faltimo configuramos HSRP en ambos CPEs para protegernos ante ca\u00eddas de uno de ellos    Con esas configuraciones conseguimos que el tr\u00e1fico saliente a una direcci\u00f3n p\u00fablica vaya por el router adecuado (HSRP) y que el tr\u00e1fico de la VPN vaya por la principal\n siempre que sea posible", 
            "title": "Incorporaci\u00f3n de un Firewall en la sede principal"
        }, 
        {
            "location": "/Servicios_implementados/#6rd", 
            "text": "Para implementar IPv6 de forma sencilla sin migrar el core de IPv4 a IPv6 utilizamos 6RD. Se basa en encapsular trafico IPv6 en paquetes IPv4.\nUtiliza tuneles multipunto para conectar los routers de los clientes a un router frontera conectado a una red IPv6.\nNota: Solo es necesario IOS 15 para implementar esta funcionalidad", 
            "title": "6RD"
        }, 
        {
            "location": "/Servicios_implementados/#border-router", 
            "text": "Activamos IPv6 en el router   ipv6 unicast-routing\n ipv6 cef    Creamos una Loopback con una ip publica. (Necesaria, ya que si no los paquetes irian con ips privadas) y guardamos prefijo que usa 6rd   ipv6 general-prefix DELEGATED_PREFIX 6rd Tunnel0\n interface Loopback1\n  ip address 30.0.255.2 255.255.255.255    Creamos el tunel    interface Tunnel1\n   no ip address\n   no ip redirects\n   ipv6 address DELEGATED_PREFIX ::/128 anycast\n   tunnel source Loopback1\n   tunnel mode ipv6ip 6rd\n   tunnel 6rd ipv4 prefix-len 16\n   tunnel 6rd prefix 2001:AAAA::/40    Enrutamos el trafico IPv6 que llega al router por el tunel que acabamos de crear   ipv6 route 2001:AAAA::/40 Tunnel1", 
            "title": "Border Router"
        }, 
        {
            "location": "/Servicios_implementados/#ce-router", 
            "text": "Activamos IPv6 en el router   ipv6 unicast-routing\n ipv6 cef    Guardamos prefijo que usa 6rd   ipv6 general-prefix DELEGATED_PREFIX 6rd Tunnel0    Creamos el tunel    interface Tunnel1\n   no ip address\n   no ip redirects\n   ipv6 enable\n   tunnel source FastEthernet1/0\n   tunnel mode ipv6ip 6rd\n   tunnel 6rd ipv4 prefix-len 16\n   tunnel 6rd prefix 2001:AAAA::/40\n   tunnel 6rd br 30.0.255.2    Le damos una IPv6 a la interfaz interna del router    ipv6 address DELEGATED_PREFIX ::/64 eui-64    Enrutamos el trafico IPv6 que llega al router por el tunel que acabamos de crear   ipv6 route 2001:AAAA::/40 Tunnel1\n ipv6 route ::/0 Tunnel1 2001:AAAA:FF:200::", 
            "title": "CE Router"
        }, 
        {
            "location": "/Servicios_implementados/#autoconfiguracion-equipos", 
            "text": "Una vez hecho todo esto, los equipos restantes se configuran solos automaticamente. Cogiendo el prefijo adecuadamente.", 
            "title": "Autoconfiguracion equipos"
        }, 
        {
            "location": "/Servicios_implementados/#enlaces", 
            "text": "http://www.cisco.com/c/en/us/products/collateral/ios-nx-os-software/enterprise-ipv6-solution/whitepaper_c11-665758.html  http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/interface/configuration/xe-3s/ir-xe-3s-book/ip6-6rd-tunls-xe.pdf  https://meetings.apnic.net/__data/assets/pdf_file/0017/31148/APRICOT-6rd-final.pdf", 
            "title": "Enlaces"
        }
    ]
}